<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>行銷設定</title>
    <!-- include libraries(jQuery, bootstrap) -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- include summernote css/js -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
</head>
<body>
<h1>Mail Template Setting</h1>
<!--<form th:action="@{/marketing/configure}" method="post">-->
<form th:action="@{/marketing/saveTemplate}" th:object="${mailTemplate}" method="post" enctype="multipart/form-data">
    <div>
        <label for="marketingSubject">主題:</label>
        <input type="text" id="marketingSubject" name="subject" th:field="*{subject}" th:required="required">
    </div>
    <br>
    <div id="marketingContent2" th:field="*{content}" th:required="required" th:rows="4"></div>
    <div style="display: none">
        <label for="marketingContent">HTML Content:</label>
        <textarea type="text" id="marketingContent" name="content" th:field="*{content}" th:required="false" th:rows="4" ></textarea>
    </div>
    <br>
    <div>
        <label for="marketingUrl">行銷網址:</label>
        <input type="text" id="marketingUrl" name="url" th:field="*{url}" th:required="required">
    </div>
    <br>
    <div th:if="${message}" style="color: green;">
        <p th:text="${message}"></p>
    </div>
    <div th:if="${error}" style="color: red;">
        <p th:text="${error}"></p>
    </div>
    <!-- Display success message if any -->
    <div>
<!--        <p>上傳圖片</p>-->
<!--        <input type="file" value="上傳照片" name="file" th:required="false"><br><br>-->
        <button type="submit">更新Email</button>
    </div>
</form>
<script>
    $(document).ready(function() {
        $('#marketingContent2').summernote({
            // 可以在這裡配置Summernote的選項
            placeholder: 'Enter your text here...',
            height: 300,
            callbacks: {
                onImageUpload: function(files) {
                    // 将图片上传到服务器
                    var formData = new FormData();
                    formData.append('image', files[0]);

                    $.ajax({
                        url: '/upload-image', // 上传图片的接口地址
                        method: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(response) {
                            // 图片上传成功后，将图片 URL 插入到编辑器中
                            console.log(response);
                            // console.log(response.url);
                            $('#marketingContent2').summernote('insertImage', response);
                        },
                        error: function(xhr, status, error) {
                            console.error(error);
                        }
                    });
                }
            }
        });
    });
    $('form').on('submit', function() {
        // 將Summernote的內容複製到隱藏的textarea中
        $('textarea[name="content"]').val($('#marketingContent2').summernote('code'));
    });
</script>
</body>
</html>