<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Audience</title>
    <link href="/images/goblin.png" rel="icon" type="image/x-icon">
    <!-- Bootstrap CSS -->
    <link href="/_css/navbar.css" rel="stylesheet">
    <link href="/_css/highchart.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css"/>
    <link href="/_css/audience.css" rel="stylesheet">
</head>
<body>
<div th:insert="_components/navbar.html"></div>
<!--<div class="container mt-5">-->
<div class="container">
    <div id="audience-title">
        <img alt="audience icon" id="audience-picture" src="/images/audience.png">
        <h1>AUDIENCE</h1>
    </div>
    <hr>
    <br>
    <h2>Add User</h2>
    <!-- Add User Form -->
    <form id="addUserForm">
        <div class="form-group">
            <label for="name">Name:</label>
            <input class="form-control" id="name" name="name" placeholder="Enter name" type="text">
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            <input class="form-control" id="email" name="email" placeholder="Enter email" type="email">
        </div>
        <div class="form-group">
            <label for="birthday">Birthday:</label>
            <input class="form-control" id="birthday" name="birthday" type="date">
        </div>
        <!--        <div class="form-group">-->
        <!--            <label for="tags">Tags:</label>-->
        <!--            <select multiple class="form-control" id="tags" name="tags">-->
        <!--                &lt;!&ndash; Tags options will be populated here &ndash;&gt;-->
        <!--            </select>-->
        <!--        </div>-->
        <!--        <div class="form-group" id="tagOptions">-->
        <!--            &lt;!&ndash; Tags options will be populated here &ndash;&gt;-->
        <!--        </div>-->
        <div class="form-group tagList-container">
            <label for="tagsList">Select Tags:</label>
            <input class="form-control" id='tagsList' name='tagsList' placeholder='write some tags'>
        </div>
        <br>
        <div id="audience-btn-container">
            <!--            <button class="btn btn-primary add-template-btn" type="submit">Add User</button>-->
            <button class="add-template-btn" type="submit">Add User</button>
        </div>
    </form>
</div>
<br><br>
<div class="container">
    <h2>Audience List</h2>
    <!-- User Table -->
    <table class="table" id="audience-table">
        <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Birthday</th>
            <th>Mail Count</th>
            <th>Open Count</th>
            <th>Click Count</th>
            <th>Tags</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody id="userList">
        <!-- 使用者資料將動態插入到這裡 -->
        </tbody>
    </table>
</div>
<!-- 使用者修改表單的動態視窗-->
<div aria-hidden="true" aria-labelledby="modifyUserModalLabel" class="modal fade" id="modifyUserModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modifyUserModalLabel">Modify User</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="modifyUserModalBody">
                <form id="modifyUserForm">
                    <div class="form-group">
                        <label for="modifyName">Name:</label>
                        <input class="form-control" id="modifyName" name="name" type="text">
                    </div>
                    <div class="form-group">
                        <label for="modifyEmail">Email:</label>
                        <input class="form-control" id="modifyEmail" name="email" type="email">
                    </div>
                    <div class="form-group">
                        <label for="modifyBirthday">Birthday:</label>
                        <input class="form-control" id="modifyBirthday" name="birthday" type="date">
                    </div>
                    <div class="form-group">
                        <label for="modifyTags">Tags:</label>
                        <input class="form-control" id="modifyTags" name="tags" placeholder="Enter tags">
                    </div>
                </form>
            </div>
            <!--            <div class="modal-footer">-->
            <!--                <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>-->
            <!--                &lt;!&ndash; 添加一个用于触发更新用户信息的按钮 &ndash;&gt;-->
            <!--                <button class="btn btn-primary" onclick="updateUser()" type="button">Update</button>-->
            <!--            </div>-->
        </div>
    </div>
</div>

<div class="d-flex justify-content-center mt-4 p8" id="audience-pagination">
    <button id="prevAudienceButton" onclick="previousAudiencePage()">❮ Prev</button>
    <span id="audience-currentPage" style="display: none">1</span>
    <button id="nextAudienceButton" onclick="nextAudiencePage()">Next ❯</button>
</div>
<div class="container" id="new-add"></div>
<figure class="container">
    <div id="new-audience-container"></div>
</figure>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script charset="utf-8" src="https://cdn.plot.ly/plotly-latest.min.js"></script>

<!--high chart import test-->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/series-label.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

<!--tagify import test-->
<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.polyfills.min.js"></script>
<script>
    // localStorage.setItem('token', 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0MTIzNDVAZXhhbXBsZS5jb20iLCJpYXQiOjE3MTM3NjIxNjEsImV4cCI6MTcxNzM2MjE2MSwiY29tcGFueSI6eyJpZCI6MTEsInRpdGxlIjoi6Zi_5a-s5YWs5Y-4IiwiZGVzY3JpcHRpb24iOiLkuIDplpPmlrDlibXlhazlj7giLCJpbmR1c3RyeSI6InNvZnR3YXJlIGRldmVsb3BtZW50IiwiYW5uaXZlcnNhcnkiOjE1ODcwNTI4MDAwMDAsImFjY291bnQiOiJ0ZXN0MTIzNDVAZXhhbXBsZS5jb20iLCJwYXNzd29yZCI6IiQyYSQxMCRhZnd2MTd4RkVLVG1VdFJ6QUVOY3V1TVN0RnJTTEJ0M1QyVW5WWktzM0VFR0J2NDl4dGVKNiIsImNvbXBhbnlfdXVpZCI6IjBhZDkwZWRkLTYyOGYtNGQwNi1iMzI4LTNhYzFkYjg1MTA2NyJ9LCJ0aXRsZSI6IumYv-WvrOWFrOWPuCIsImFjY291bnQiOiJ0ZXN0MTIzNDVAZXhhbXBsZS5jb20ifQ.7ywY3ZbEZdLhRHNXsFcC3aaEUbP6G-nm2_AmIp5-oq4');
    const companyId = localStorage.getItem('companyId');
    const token = localStorage.getItem('token');
    const headers = {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
    };
    // window.onload = async function () {
    //     await loadTags();
    //     await loadUsersWithPage(0);
    // }
    loadTags('input[name=tagsList]');
    loadUsersWithPage(0);

    async function loadTags(elementName) {
        try {
            const response = await fetch('/api/1.0/tag/get', {
                method: 'GET',
                headers: headers
            });
            const tags = await response.json();
            // displayTags(tags);
            // populateTagOptions(tags);
            // console.log(tags);
            const newArray = tags.map(obj => ({...obj, value: obj.name}))
            console.log(newArray);
            drawTagListWithTagify(newArray, elementName);
        } catch (error) {
            console.error(error);
        }
    }


    async function loadUsers() {
        try {
            const response = await fetch('/api/1.0/audience/all', {
                method: 'GET',
                headers: headers
            });
            const users = await response.json();
            displayUsers(users);
        } catch (error) {
            console.error(error);
            alert('Failed to load users');
        }
    }

    async function loadUsersWithPage(paging) {
        try {
            const response = await fetch(`api/1.0/audience/paging?number=${paging}`, {
                method: 'GET',
                headers: headers
            });
            const audienceData = await response.json();
            const audiences = audienceData.data;
            const nextPage = audienceData.next_paging;
            console.log(audiences);
            displayUsers(audiences);

            const prevButton = document.getElementById('prevAudienceButton');
            const nextButton = document.getElementById('nextAudienceButton');
            if (paging <= 0) {
                prevButton.disabled = true;
                prevButton.classList.add("is-active")
            } else {
                prevButton.disabled = false;
                prevButton.classList.remove("is-active")
            }
            if (typeof nextPage === 'undefined') {
                nextButton.disabled = true;
                nextButton.classList.add("is-active")
            } else {
                nextButton.disabled = false;
                nextButton.classList.remove("is-active")
            }

        } catch (error) {
            console.log(error);
        }
    }

    let currentAudiencePage = 0;

    function nextAudiencePage() {
        currentAudiencePage++;
        document.getElementById('audience-currentPage').innerText = currentAudiencePage + 1;
        loadUsersWithPage(currentAudiencePage);
    }

    function previousAudiencePage() {
        if (currentAudiencePage >= 1) {
            currentAudiencePage--;
            document.getElementById('audience-currentPage').innerText = currentAudiencePage + 1;
            loadUsersWithPage(currentAudiencePage);
        }
    }

    // 顯示使用者列表
    function displayUsers(users) {
        const userList = document.getElementById('userList');
        userList.innerHTML = ''; // 清空現有列表

        users.forEach(function (user) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${user.name}</td>
                <td>${user.email}</td>
                <td>${user.birthday}</td>
                <td>${user.mailcount}</td>
                <td>${user.opencount}</td>
                <td>${user.clickcount}</td>
                <td>${getTagsAsString(user.tags)}</td>
                <td class="action-container">
                <button class="btn btn-success btn-action" onclick="modifyUser(${user.id})"><img class="delete-image" src="/images/edit.png" alt="edit image"></button>
                <button class="btn btn-danger btn-action" onclick="deleteUser(${user.id})"><img class="delete-image" src="/images/trash_can.png" alt="delete image"></button>
                </td>
            `;
            userList.appendChild(row);
        });
    }

    // <td className="action-container">
    //     <button className="btn btn-success btn-sm" onClick="modifyUser(${user.id})">Modify</button>
    // <button className="btn btn-danger btn-sm" onClick="deleteUser(${user.id})">Delete</button>
    // </td>

    // 將標籤轉換為字串
    function getTagsAsString(tags) {
        if (!tags || tags.length === 0) {
            return 'No tags';
        }
        return tags.map(tag => tag.name).join(', ');
    }

    //修改使用者
    async function modifyUser(userId) {
        try {
            const response = await fetch(`/api/1.0/audience/get?id=${userId}`, {
                method: 'GET',
                headers: headers
            });
            if (response.ok) {
                const userData = await response.json();
                // 填充用户信息到模态框中
                populateModifyUserModal(userData);
                // 显示模态框
                $('#modifyUserModal').modal('show');
            } else {
                throw new Error('Failed to get user data');
            }
        } catch (error) {
            console.error(error);
            alert('Failed to get user data');
        }
    }

    // function populateModifyUserModal(userData) {
    //     const modalBody = document.getElementById('modifyUserModalBody');
    //     modalBody.innerHTML = `
    //     <p>ID: ${userData.id}</p>
    //     <p>Name: ${userData.name}</p>
    //     <p>Email: ${userData.email}</p>
    //     <p>Birthday: ${userData.birthday}</p>
    //     <p>Tags: ${getTagsAsString(userData.tags)}</p>
    // `;
    // }

    function populateModifyUserModal(userData) {
        const modalBody = document.getElementById('modifyUserModalBody');
        modalBody.innerHTML = `
        <div class="form-group">
            <label for="modifyName">Name:</label>
            <input class="form-control" id="modifyName" name="modifyName" type="text" value="${userData.name}">
        </div>
        <div class="form-group">
            <label for="modifyEmail">Email:</label>
            <input class="form-control" id="modifyEmail" name="modifyEmail" type="email" value="${userData.email}">
        </div>
        <div class="form-group">
            <label for="modifyBirthday">Birthday:</label>
            <input class="form-control" id="modifyBirthday" name="modifyBirthday" type="date" value="${userData.birthday}">
        </div>
        <div id="modify-tag-list" class="form-group">
            <label for="modifyTags">Tags:</label>
            <input class="form-control" id="modifyTags" name="modifyTags" type="text" value="${getTagsAsString(userData.tags)}">
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-dismiss="modal" type="button">Close</button>
            <!-- 添加一个用于触发更新用户信息的按钮 -->
            <button class="btn btn-primary" onclick="updateUser(${userData.id})" type="button">Update</button>
        </div>
    `;
        loadTags('#modifyTags');
    }

    // function populateModifyUserModal(userData) {
    //     document.getElementById('modifyName').value = userData.name;
    //     document.getElementById('modifyEmail').value = userData.email;
    //     document.getElementById('modifyBirthday').value = userData.birthday;
    //     document.getElementById('modifyTags').value = getTagsAsString(userData.tags);
    // }

    async function updateUser(userID) {
        try {
            // 获取表单中的值
            // const id =userID /* 获取用户ID */;
            const name = document.getElementById('modifyName').value;
            const email = document.getElementById('modifyEmail').value;
            const birthday = document.getElementById('modifyBirthday').value;
            // const tags = document.getElementById('modifyTags').value.split(','); // 将标签字符串转换为数组

            // 构建请求体
            const requestBody = {
                name: name,
                email: email,
                birthday: birthday,
                tags: []
                // tags: tags.map(tag => ({ id: /* 根据标签名称从后端获取对应的ID */, name: tag }))
            };

            document.querySelectorAll('#modify-tag-list .tagify .tagify__tag ').forEach(function (tagElement) {
                requestBody.tags.push({
                    id: parseInt(tagElement.id), // 將值轉換為整數
                    company_id: companyId, // 假設 company_id 固定為 1，你可以根據實際情況調整
                    name: tagElement.title // 如果需要，你可以從 checkbox 的 data 屬性中獲取標籤名稱
                });
            });

            // 发送 PATCH 请求到后端
            const response = await fetch(`/api/1.0/audience/update?id=${userID}`, {
                method: 'PATCH',
                headers: headers,
                body: JSON.stringify(requestBody)
            });

            if (response.ok) {
                alert('User updated successfully');
                $('#modifyUserModal').modal('hide');
                await loadUsersWithPage(currentAudiencePage);
            } else {
                throw new Error('Failed to update user');
            }
        } catch (error) {
            console.error(error);
            alert('Failed to update user');
        }
    }

    // 刪除使用者
    async function deleteUser(userId) {
        try {
            const response = await fetch(`/api/1.0/audience/delete?id=${userId}`, {
                method: 'DELETE',
                headers: headers
            });
            if (response.ok) {
                alert('User deleted successfully');
                // await loadUsers(); // 重新載入使用者列表
                await loadUsersWithPage(currentAudiencePage);
            } else {
                throw new Error('Failed to delete user');
            }
        } catch (error) {
            console.error(error);
            alert('Failed to delete user');
        }
    }

    // 填充標籤選項
    function populateTagOptions(tags) {
        // const tagSelect = document.getElementById('tags');
        // tagSelect.innerHTML = ''; // 清空選項

        // tags.forEach(function(tag) {
        //     const option = document.createElement('option');
        //     option.value = tag.id;
        //     option.innerText = tag.name;
        //     tagSelect.appendChild(option);
        // });
        const tagOptionsDiv = document.getElementById('tagOptions');
        tagOptionsDiv.innerHTML = ''; // 清空選項

        tags.forEach(function (tag) {
            const checkboxDiv = document.createElement('div');
            checkboxDiv.classList.add('form-check');

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.classList.add('form-check-input');
            checkbox.value = tag.id;
            checkbox.name = 'tags';
            checkbox.id = 'tag' + tag.id;

            const label = document.createElement('label');
            label.classList.add('form-check-label');
            label.htmlFor = 'tag' + tag.id;
            label.innerText = tag.name;

            checkboxDiv.appendChild(checkbox);
            checkboxDiv.appendChild(label);

            tagOptionsDiv.appendChild(checkboxDiv);
        });
    }

    document.getElementById('addUserForm').addEventListener('submit', async function (event) {
        event.preventDefault(); // 阻止表單默認提交行為

        // 手動構建包含 name、email 和 birthday 的對象
        const user = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            birthday: document.getElementById('birthday').value,
            tags: [] // 初始化 tags 數組
        };

        // 遍歷選中的標籤，將其添加到 tags 數組中
        // document.querySelectorAll('input[name="tags"]:checked').forEach(function (checkbox) {
        //     user.tags.push({
        //         id: parseInt(checkbox.value), // 將值轉換為整數
        //         company_id: 11, // 假設 company_id 固定為 1，你可以根據實際情況調整
        //         name: checkbox.dataset.name // 如果需要，你可以從 checkbox 的 data 屬性中獲取標籤名稱
        //     });
        // });

        // 遍歷選中的標籤，將其添加到 tags 數組中
        document.querySelectorAll('.tagify__tag ').forEach(function (tagElement) {
            user.tags.push({
                id: parseInt(tagElement.id), // 將值轉換為整數
                company_id: companyId, // 假設 company_id 固定為 1，你可以根據實際情況調整
                name: tagElement.title // 如果需要，你可以從 checkbox 的 data 屬性中獲取標籤名稱
            });
        });


        // 將 user 對象轉換為 JSON 字符串並添加到 FormData 中
        const formData = new FormData();
        formData.append('user', JSON.stringify(user));

        console.log(formData.toString()); // 輸出 FormData 字符串表示形式
        console.log([...formData]); // 輸出 FormData 中的鍵值對

        // 提交 FormData
        try {
            const response = await fetch('/api/1.0/audience/add', {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(user)
                // body: JSON.stringify(requestData)
            });
            if (response.ok) {
                alert('User added successfully');
                // 清空表單
                this.reset();
                await loadTags('input[name=tagsList]'); // 重新載入標籤列表
                await loadUsersWithPage(currentAudiencePage);
            } else {
                throw new Error('Failed to add user');
            }
        } catch (error) {
            console.error(error);
            alert('Failed to add user');
        }
    });

    async function fetchNewAudienceData(days) {
        try {
            const response = await fetch('/api/1.0/audience/new-count?days=' + days, {
                method: 'GET',
                headers: headers
            });
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return await response.json();
        } catch (error) {
            throw new Error('There was a problem with the fetch operation:', error);
        }
    }

    function drawNewAudienceChart(data, elementID) {
        const categories = Object.keys(data).reverse();
        const newAudienceData = Object.values(data).reverse();
        Highcharts.chart(elementID, {
            chart: {
                type: 'column'
            },
            title: {
                text: 'New Audience Count in the Last 7 Days',
                align: 'left'
            },
            subtitle: {
                text: 'Source: Your API Endpoint',
                align: 'left'
            },
            xAxis: {
                categories: categories,
                accessibility: {
                    description: 'Dates'
                }
            },
            yAxis: {
                title: {
                    text: 'Count'
                }
            },
            tooltip: {
                valueSuffix: ''
            },
            series: [{
                name: 'New Audience',
                data: newAudienceData,
                color: '#10B981'
            }]
        });
    }

    async function fetchAndDrawNewAudienceChart() {
        try {
            const data = await fetchNewAudienceData(7);
            drawNewAudienceChart(data, 'new-audience-container');
        } catch (error) {
            console.error(error);
        }
    }

    fetchAndDrawNewAudienceChart();

    function drawTagListWithTagify(tags, elementName) {
        let whitelist = tags;
        console.log(tags);
        let input = document.querySelector(elementName)

        let tagify = new Tagify(input, {
            whitelist: whitelist,
            tagTextProp: "name",
            dropdown: {
                position: "manual",
                maxItems: Infinity,
                enabled: 0,
                classname: "customSuggestionsList"
            },
            enforceWhitelist: true
        })

        tagify.on("dropdown:show", onSuggestionsListUpdate)
            .on("dropdown:hide", onSuggestionsListHide)
            .on('dropdown:scroll', onDropdownScroll)
        renderSuggestionsList(tagify)
    }

    // var whitelist = ["A# .NET", "A# (Axiom)", "A-0 System", "A+", "A++", "ABAP", "ABC", "ABC ALGOL", "ABSET", "ABSYS", "ACC", "Accent", "Ace DASL", "ACL2", "Avicsoft", "ACT-III", "Action!", "ActionScript", "Ada", "Adenine", "Agda", "Agilent VEE", "Agora", "AIMMS", "Alef", "ALF", "ALGOL 58", "ALGOL 60", "ALGOL 68", "ALGOL W", "Alice", "Alma-0", "AmbientTalk", "Amiga E", "AMOS", "AMPL", "Apex (Salesforce.com)", "APL", "AppleScript", "Arc", "ARexx", "Argus", "AspectJ", "Assembly language", "ATS", "Ateji PX", "AutoHotkey", "Autocoder", "AutoIt", "AutoLISP / Visual LISP", "Averest", "AWK", "Axum", "Active Server Pages", "ASP.NET", "B", "Babbage", "Bash", "BASIC", "bc", "BCPL", "BeanShell", "Batch (Windows/Dos)", "Bertrand", "BETA", "Bigwig", "Bistro", "BitC", "BLISS", "Blockly", "BlooP", "Blue", "Boo", "Boomerang", "Bourne shell (including bash and ksh)", "BREW", "BPEL", "B", "C--", "C++ – ISO/IEC 14882", "C# – ISO/IEC 23270", "C/AL", "Caché ObjectScript", "C Shell", "Caml", "Cayenne", "CDuce", "Cecil", "Cesil", "Céu", "Ceylon", "CFEngine", "CFML", "Cg", "Ch", "Chapel", "Charity", "Charm", "Chef", "CHILL", "CHIP-8", "chomski", "ChucK", "CICS", "Cilk", "Citrine (programming language)", "CL (IBM)", "Claire", "Clarion", "Clean", "Clipper", "CLIPS", "CLIST", "Clojure", "CLU", "CMS-2", "COBOL – ISO/IEC 1989", "CobolScript – COBOL Scripting language", "Cobra", "CODE", "CoffeeScript", "ColdFusion", "COMAL", "Combined Programming Language (CPL)", "COMIT", "Common Intermediate Language (CIL)", "Common Lisp (also known as CL)", "COMPASS", "Component Pascal", "Constraint Handling Rules (CHR)", "COMTRAN", "Converge", "Cool", "Coq", "Coral 66", "Corn", "CorVision", "COWSEL", "CPL", "CPL", "Cryptol", "csh", "Csound", "CSP", "CUDA", "Curl", "Curry", "Cybil", "Cyclone", "Cython", "Java", "Javascript", "M2001", "M4", "M#", "Machine code", "MAD (Michigan Algorithm Decoder)", "MAD/I", "Magik", "Magma", "make", "Maple", "MAPPER now part of BIS", "MARK-IV now VISION:BUILDER", "Mary", "MASM Microsoft Assembly x86", "MATH-MATIC", "Mathematica", "MATLAB", "Maxima (see also Macsyma)", "Max (Max Msp – Graphical Programming Environment)", "Maya (MEL)", "MDL", "Mercury", "Mesa", "Metafont", "Microcode", "MicroScript", "MIIS", "Milk (programming language)", "MIMIC", "Mirah", "Miranda", "MIVA Script", "ML", "Model 204", "Modelica", "Modula", "Modula-2", "Modula-3", "Mohol", "MOO", "Mortran", "Mouse", "MPD", "Mathcad", "MSIL – deprecated name for CIL", "MSL", "MUMPS", "Mystic Programming L"]
    //
    // var input = document.querySelector('input[name=tags]');
    //
    // // init Tagify script on the above inputs
    // var tagify = new Tagify(input, {
    //     whitelist: whitelist,
    //     dropdown: {
    //         position: "manual",
    //         maxItems: Infinity,
    //         enabled: 0,
    //         classname: "customSuggestionsList"
    //     },
    //     enforceWhitelist: true
    // })
    //
    // tagify.on("dropdown:show", onSuggestionsListUpdate)
    //     .on("dropdown:hide", onSuggestionsListHide)
    //     .on('dropdown:scroll', onDropdownScroll)
    //
    // renderSuggestionsList()

    // ES2015 argument destructuring
    function onSuggestionsListUpdate({detail: suggestionsElm}) {
        console.log(suggestionsElm)
    }

    function onSuggestionsListHide() {
        console.log("hide dropdown")
    }

    function onDropdownScroll(e) {
        console.log(e.detail)
    }

    // https://developer.mozilla.org/en-US/docs/Web/API/Element/insertAdjacentElement
    function renderSuggestionsList(tagify) {
        tagify.dropdown.show.call(tagify) // load the list
        tagify.DOM.scope.parentNode.appendChild(tagify.DOM.dropdown)
    }


</script>
</body>
</html>